@use 'utilities/variables' as vars;
@use 'utilities/mixins' as mixins;
@use 'sass:math';

.fan-menu {
  position: relative;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  z-index: 1000; // High z-index to appear above cover images

  &__trigger {
    @include mixins.header-icon-button;
    position: relative;
    z-index: 1001;
    transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  }

  &__icon {
    transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    transform-origin: center;

    &--rotated {
      transform: rotate(90deg);
    }
  }

  &__buttons {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    pointer-events: none;
    z-index: 1000;
  }

  &__button-wrapper {
    position: absolute;
    top: 0;
    left: 0;
    transform: translate(-50%, -50%);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.75rem; // Increased gap between button and label
    opacity: 0;
    pointer-events: none;
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  }

  &__button {
    @include mixins.header-icon-button;
    position: relative;
    z-index: 1001;
    pointer-events: auto;
    transform: scale(0);
    background-color: var(--bg-tertiary) !important; // Solid background
    border: 1px solid var(--border-primary) !important; // Gentle border
    transition:
      transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1),
      background-color 0.2s ease,
      border-color 0.2s ease,
      box-shadow 0.2s ease;

    &:hover {
      transform: scale(1.1);
      z-index: 1002;
      background-color: var(--bg-secondary) !important;
      border-color: var(--border-hover) !important; // Slightly more visible on hover
    }

    &:active {
      transform: scale(0.95);
    }
  }

  &__label {
    position: absolute;
    top: 100%; // Position below the button
    white-space: nowrap;
    font-size: 0.75rem;
    color: var(--text-primary);
    background: vars.$dark-bg-15-55;
    padding: 0.375rem 0.625rem; // Increased padding for better spacing
    border-radius: 6px;
    backdrop-filter: blur(10px);
    opacity: 0;
    pointer-events: none;
    transition:
      opacity 0.2s ease,
      transform 0.2s ease;
    transform: translateY(0.5rem); // Start further down
    margin-top: 0.25rem; // Additional spacing from button
    z-index: 1003; // Highest z-index for labels
  }

  // Fan menu open state
  &--open {
    .fan-menu__button-wrapper {
      opacity: 1;
      pointer-events: auto;
      transform: translate(calc(-50% + var(--x, 0px)), calc(-50% + var(--y, 0px)));
      transition-delay: var(--delay, 0s);
    }

    .fan-menu__button {
      transform: scale(1);
      transition-delay: calc(var(--delay, 0s) + 0.1s);
    }

    .fan-menu__button-wrapper:hover .fan-menu__label {
      opacity: 1;
      transform: translateY(0.25rem); // Final position with proper spacing
    }
  }

  // RTL support is handled in JavaScript by reversing the angle calculation
  // No additional CSS needed since positions are calculated dynamically
}
